// Generated by CoffeeScript 1.6.3
var appContext,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

require.config({
  paths: {
    jquery: "/components/jquery/jquery.min",
    bootstrap: "/components/bootstrap/dist/js/bootstrap.min",
    bootstrapDatepicker: "/components/bootstrap-datepicker/js/bootstrap-datepicker",
    batman: "/batmanjs/batman",
    latestROMS: "/latestROMS.json?callback=define"
  },
  shim: {
    bootstrap: {
      deps: ["jquery"]
    },
    bootstrapDatepicker: {
      deps: ["bootstrap"]
    },
    batman: {
      deps: ["jquery"],
      exports: "Batman"
    }
  },
  waitSeconds: 30
});

appContext = void 0;

define("Batman", ["batman"], function(Batman) {
  return Batman.DOM.readers.batmantarget = Batman.DOM.readers.target && delete Batman.DOM.readers.target && Batman;
});

require(["jquery", "Batman", "latestROMS", "bootstrap", "bootstrapDatepicker"], function($, Batman, latestROMS) {
  var AppContext, Rompg, padTo2Digits, _ref;
  padTo2Digits = function(n) {
    if (n < 10) {
      return "0" + n;
    } else {
      return n;
    }
  };
  AppContext = (function(_super) {
    __extends(AppContext, _super);

    function AppContext() {
      AppContext.__super__.constructor.apply(this, arguments);
      if (window.location.pathname === "/") {
        this.set("homeContext", new this.HomeContext);
      }
      if (window.location.pathname === "/roms") {
        this.set("romsContext", new this.RomsContext);
      }
    }

    AppContext.prototype.HomeContext = (function(_super1) {
      __extends(HomeContext, _super1);

      function HomeContext() {
        var now, variable, _i, _len, _ref;
        HomeContext.__super__.constructor.apply(this, arguments);
        _ref = ["curr", "salinity", "ssh", "temp"];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          variable = _ref[_i];
          now = new Date(latestROMS.ca[variable]);
          this.set("latestCaRomsImagePath_" + variable, "/data/ca-roms/" + (now.getUTCFullYear()) + "/ca_" + variable + (padTo2Digits(now.getUTCMonth() + 1)) + (padTo2Digits(now.getUTCDate())) + "_" + (padTo2Digits(now.getUTCHours())) + "_0.jpg");
        }
      }

      return HomeContext;

    })(Batman.Model);

    AppContext.prototype.RomsContext = (function(_super1) {
      var varMap,
        _this = this;

      __extends(RomsContext, _super1);

      varMap = {
        curr: "Current",
        salinity: "Salinity and Current",
        ssh: "Sea Surface Height and Current",
        temp: "Temperature and Current"
      };

      RomsContext.accessor("is03Selected", function() {
        return this.get("latestTime") === "03 UTC";
      });

      RomsContext.accessor("is09Selected", function() {
        return this.get("latestTime") === "09 UTC";
      });

      RomsContext.accessor("is15Selected", function() {
        return this.get("latestTime") === "15 UTC";
      });

      RomsContext.accessor("is21Selected", function() {
        return this.get("latestTime") === "21 UTC";
      });

      RomsContext.accessor("imgPath", function() {
        return "/data/ca-roms/" + (now.getUTCFullYear()) + "/" + (RomsContext.get("region")) + "_" + (RomsContext.get("variable")) + (padTo2Digits(now.getUTCMonth() + 1)) + (padTo2Digits(now.getUTCDate())) + "_" + (padTo2Digits(now.getUTCHours())) + "_0.jpg";
      });

      RomsContext.accessor("isCurr", function() {
        return this.get("variable") === "Current";
      });

      RomsContext.accessor("isSalinity", function() {
        return this.get("variable") === "Salinity and Current";
      });

      RomsContext.accessor("isSSH", function() {
        return this.get("variable") === "Sea Surface Height and Current";
      });

      RomsContext.accessor("isTemp", function() {
        return this.get("variable") === "Temperature and Current";
      });

      function RomsContext() {
        var _this = this;
        RomsContext.__super__.constructor.apply(this, arguments);
        if (varMap[window.location.hash.slice(1)] != null) {
          this.set("variable", window.location.hash.slice(1));
        } else {
          this.set("variable", "curr");
        }
        this.set("region", "ca");
        $("[data-provide=\"datepicker-inline\"]").on("changeDate", function(e) {
          var now;
          e.date.setMilliseconds(e.date.getMilliseconds() - e.date.getTimezoneOffset() * 60 * 1000);
          now = _this.get("now");
          now.setDate(e.date.getDate());
          now.setMonth(e.date.getMonth());
          return now.setFullYear(e.date.getFullYear());
        });
        this.set("variable", "Current");
      }

      RomsContext.prototype.timeChanged = function(node) {
        return this.get("now").setHours($(node).attr("data-value"));
      };

      RomsContext.prototype.changeTime = function(time) {
        var node;
        node = $("[data-value=\"" + time + "\"]")[0];
        if (!$(node).hasClass("active")) {
          return $(node).button("toggle");
        }
      };

      RomsContext.prototype.changeDate = function(date) {
        var hd;
        this.set("now", date);
        $("[data-provide=\"datepicker-inline\"]").datepicker("update", "" + (date.getMonth() + 1) + "/" + (date.getDate()) + "/" + (date.getFullYear()));
        if (!$(hd).hasClass("active")) {
          return $(hd = "[data-value=\"" + (date.getHours()) + "\"]").button("toggle");
        }
      };

      RomsContext.prototype.imageError = function() {
        return this.set("imageError", true);
      };

      RomsContext.prototype.imageLoad = function() {
        return this.set("imageError", false);
      };

      RomsContext.prototype.variableChanged = function(node) {
        return this.set("variable", $(node).attr("data-value"));
      };

      return RomsContext;

    }).call(this, Batman.Model);

    return AppContext;

  }).call(this, Batman.Model);
  Rompg = (function(_super) {
    __extends(Rompg, _super);

    function Rompg() {
      _ref = Rompg.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    Rompg.appContext = appContext = new AppContext;

    return Rompg;

  })(Batman.App);
  return Rompg.run();
});
